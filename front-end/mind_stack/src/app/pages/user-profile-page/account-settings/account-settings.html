<div class="modal-overlay-account">
    <div class="account-setting-class" (click)="$event.stopPropagation()">
        <div class="account-setting-label">
            <h1>Change Password</h1>
        </div>

        <form [formGroup]="accountSettingForm" (ngSubmit)="accountSettingInformation()">
        <div class="form-group">
            <div class="current-password-class">
                <div class="current-password-label">
                    <label>Current Password</label>
                </div>
                <input type="password" formControlName="current_password" placeholder="Enter your current password">
                <div class="error-message">
                    @if(passwordControl?.touched) {
                        @if (passwordControl?.errors?.['required']) {
                            <span>Current password is required</span>
                        }
                    }
                </div>
            </div>

            <div class="new-password-class">
                <div class="new-password-label">
                    <label>New Password</label>
                </div>
                <div class="password-input-container">
                    <input type="password" formControlName="new_password" placeholder="Enter your new password">
                </div>
                <div class="error-message">
                    @if (newPasswordControl?.dirty || newPasswordControl?.touched) {
                        @if(newPasswordControl?.errors?.['required']) {
                            <span>New password is required</span>
                        } @else if(newPasswordControl?.errors?.['minlength']) {
                            <span>Password must be at least 8 characters</span>
                        } @else if(newPasswordControl?.errors?.['uppercase']) {
                            <span>Password must contain at least one uppercase letter</span>
                        } @else if(newPasswordControl?.errors?.['lowercase']) {
                            <span>Password must contain at least one lowercase letter</span>
                        } @else if(newPasswordControl?.errors?.['number']) {
                            <span>Password must contain at least one number</span>
                        } @else if(newPasswordControl?.errors?.['special']) {
                            <span>Password must contain at least one special character (e.g. !@#$%^&*)</span>
                        }
                    }
                </div>
            </div>

            <div class="confirm-password-class">
                <div class="confirm-password-label">
                    <label>Confirm Password</label>
                </div>
                <input type="password" formControlName="confirm_password" placeholder="Confirm your new password">
            </div>

            <div class="error-message password-match-error">
                @if(confirmPasswordControl?.dirty || confirmPasswordControl?.touched) {
                    @if(confirmPasswordControl?.errors?.['required']) {
                        <span>Confirm password is required</span>
                    } @else if(confirmPasswordControl?.value && newPasswordControl?.value && confirmPasswordControl?.value !== newPasswordControl?.value) {
                        <span>Passwords must match</span>
                    }
                }
            </div>
        </div>

       <div class="button-class">
            <button type="button" id="cancel_button_password" (click)="cancel()">Cancel</button>
            <button type="submit" id="submit_button_password"
                [disabled]="accountSettingForm.invalid || loading || (confirmPasswordControl?.dirty || confirmPasswordControl?.touched) && (confirmPasswordControl?.errors?.['required'] || (confirmPasswordControl?.value && newPasswordControl?.value && confirmPasswordControl?.value !== newPasswordControl?.value))">
                @if(loading) { 
                    <span>Saving...</span> 
                } @else { 
                    <span>Save</span> 
                }
            </button>
        </div> 
    </form>
    </div>
</div>

@if (showSuccessPopup) {
    <div class="popup-overlay" (click)="closeSuccessPopup()">
        <div class="popup" (click)="$event.stopPropagation()">
            <h2>Success!</h2>
            <p>Your password has been updated successfully.</p>
            <button (click)="closeSuccessPopup()">OK</button>
        </div>
    </div>
}