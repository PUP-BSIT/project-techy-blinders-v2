<app-nav-bar></app-nav-bar>

<div class="container">
    <div class="logo-class">
        <div class="header-class">
            <h1>Join today and transform your notes into smarter study tools.</h1>
        </div>

        <div class="image-class">
            <img src="assets/register.png">
        </div>
    </div>

    <div class="seperator-class"></div>

    <div class="registration-form">
        <form [formGroup]="registrationForm" (ngSubmit)="register()">
            <div class="form-group">
                <label>Email</label>
                <input 
                    type="text" 
                    formControlName="email" 
                    placeholder="Enter your email" 
                    maxlength="50">
                <div class="validation-message">
                    @if (emailControl?.touched) {
                        @if (emailControl?.errors?.['required']) {
                            <span>Email is required</span>
                        }@else if(emailControl?.errors?.['email']) {
                            <span>Invalid email format</span>
                        }@else if (emailControl?.errors?.['maxlength']) {
                            <span>Email can only contain up to 50 characters</span>
                        }
                    }
                </div>
            </div>

            <div class="form-group">
                <label>Username</label>
                <input type="text" formControlName="username" placeholder="Enter your username">
                <div class="validation-message">
                    @if (usernameControl?.touched) {
                        @if(usernameControl?.errors?.['required']) {
                            <span>Username is required</span>
                        }@else if (usernameControl?.errors?.['maxlength']) {
                            <span>Username can only contain up to 20 characters</span>
                        }
                    }
                </div>
            </div>

            <div class="form-group">
                <label>Password</label>
                <div class="password-input-container">
                    <input
                        [type]="showPassword ? 'text' : 'password'"
                        formControlName="password"
                        placeholder="Enter your password"
                        maxlength="20">
                    <button
                        type="button"
                        class="show-password-btn"
                        (click)="togglePasswordVisibility()">
                        <img
                            [src]="showPassword
                                ? 'assets/unshow-password-icon.png'
                                : 'assets/show-password-icon.png'"
                            [alt]="showPassword
                                ? 'Hide password'
                                : 'Show password'">
                    </button>
                </div>
                <div class="validation-message">
                    @if(passwordControl?.dirty || passwordControl?.touched) {
                        @if(passwordControl?.errors?.['required']){
                            <span>Password is required</span>
                        } @else if(passwordControl?.errors?.['minlength']) {
                            <span>Password must be at least 8 characters</span>
                        } @else if(passwordControl?.errors?.['uppercase']) {
                            <span>Password must contain at least one uppercase letter</span>
                        } @else if(passwordControl?.errors?.['lowercase']) {
                            <span>Password must contain at least one lowercase letter</span>
                        } @else if(passwordControl?.errors?.['number']) {
                            <span>Password must contain at least one number</span>
                        } @else if(passwordControl?.errors?.['special']) {
                            <span>Password must contain at least one special character (e.g. !@#$%^&*)</span>
                        }
                    }
                </div>
            </div>

            <div class="form-group">
                <label>Confirm Password</label>
                <div class="password-input-container">
                    <input
                        [type]="showConfirmPassword ? 'text' : 'password'"
                        formControlName="confirmPassword"
                        placeholder="Confirm your password"
                        maxlength="20">
                    <button
                        type="button"
                        class="show-password-btn"
                        (click)="toggleConfirmPasswordVisibility()">
                        <img
                            [src]="showConfirmPassword
                                ? 'assets/unshow-password-icon.png'
                                : 'assets/show-password-icon.png'"
                            [alt]="showConfirmPassword
                                ? 'Hide password'
                                : 'Show password'">
                    </button>
                </div>
                <div class="validation-message">
                    @if (confirmPasswordControl?.dirty || confirmPasswordControl?.touched) {
                        @if(confirmPasswordControl?.errors?.['required']) {
                            <span>Confirm your password</span>
                        } @else if(confirmPasswordControl?.value !== passwordControl?.value) {
                            <span>Passwords must match</span>
                        }
                    }
                </div>
            </div>

            <div class="submit-class">
                <button
                  type="submit"
                  [disabled]="!isFormValid() || isLoading()"
                  [style.cursor]="isLoading() || !isFormValid() ? 'not-allowed' : 'pointer'"
                >
                  {{ isLoading() ? 'Registering...' : 'Register' }}
                </button>
            </div>
            <div class="cancel-button">
                <button type="button" (click)="goToLandingPage()">Cancel</button>
            </div>
        </form>
    </div>

    @if (successMessage() || errorMessage()) {
        @if (showSubmitPopup()) {
            <div class="popup-overlay" (click)="closeSubmitPopup()">
                <div class="popup" 
                    [class.success]="!!successMessage()" 
                    [class.warning]="!successMessage()" 
                    (click)="$event.stopPropagation()">
                    <h2>{{ successMessage() ? 'Success!' : 'Error' }}</h2>
                    <p>{{ successMessage() || errorMessage() }}</p>
                    <button (click)="closeSubmitPopup()">OK</button>
                </div>
            </div>
        }
    }
</div>