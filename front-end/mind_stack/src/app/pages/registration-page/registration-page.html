<app-nav-bar></app-nav-bar>

<div class="container">
    <div class="logo-class">
        <div class="header-class">
            <h1>Join today and transform your notes into smarter study tools.</h1>
        </div>

        <div class="image-class">
            <img src="assets/register.png">
        </div>
    </div>

    <div class="seperator-class">

    </div>

    <div class="registration-form">
        <form [formGroup]="registrationFrom" (ngSubmit)="registrationValidation()">
            <div class="form-group">
                <label>Email</label>
                <input type="text" formControlName="email" placeholder="Email">
                <div class="validation-message">
                    @if (emailControl?.touched) {
                        @if (emailControl?.errors?.['required']) {
                            <span>Input Email</span>
                        }@else if(emailControl?.errors?.['email']) {
                            <span>Invalid Email</span>
                        }@else if (emailControl?.errors?.['maxlength']) {
                            <span>Email can only contain up to 20 characters</span>
                        }
                    }
                </div>
            </div>

            <div class="form-group">
                <label>Username</label>
                <input type="text" formControlName="username" placeholder="Username">
                <div class="validation-message">
                    @if (usernameControl?.touched) {
                        @if(usernameControl?.errors?.['required']) {
                            <span>Input Username</span>
                        }@else if (usernameControl?.errors?.['maxlength']) {
                            <span>Username can only contain up to 20 characters</span>
                        }
                    }
                </div>
            </div>

            <div class="form-group">
                <label>Password</label>
                <input type="password" formControlName="password" placeholder="Password">
                <div class="validation-message">
                    @if(passwordControl?.touched) {
                        @if(passwordControl?.errors?.['required']){
                            <span>Input password</span>
                        }@else if(passwordControl?.errors?.['minlength']) {
                            <span>Password must be at least 6 characters</span>
                        }
                    }
                </div>
            </div>

            <div class="form-group">
                <label>Confirm Password</label>
                <input type="password" formControlName="confirmPassword" placeholder="Confirm password">
                <div class="validation-message">
                    @if (confirmPasswordControl?.touched) {
                        @if(confirmPasswordControl?.errors?.['required']) {
                            <span>Confirm your password</span>
                        }@else if(confirmPasswordControl?.value !== passwordControl?.value) {
                            <span>Password is not match</span>
                        }
                    }
                </div>
            </div>

            @if (isLoading) {
                <div class="loading-message">
                    <span>Registering...</span>
                </div>
            }

            <div class="submit-class">
                <button type="submit" [disabled]="!isFormValid() || isLoading">Register</button>
            </div>
            <div class="cancel-button">
                <button type="reset">Cancel</button>
            </div>
        </form>
    </div>
</div>

@if (isSuccessModalOpen) {
    <div class="modal-backdrop">
        <div class="modal-content">
            <h2>Registration Successful!</h2>
            <p>Your account has been created successfully.</p>

            @if (registeredUserId !== null) {
                <div class="user-id-section">
                    <p class="user-id-instruction">Please save your User ID for login:</p>
                    <div class="user-id-row">
                        <span class="user-id-label">User ID:</span>
                        <div class="user-id-pill">
                            <span class="user-id-value">{{ registeredUserId }}</span>
                            <button type="button" 
                                    class="copy-user-id-button" 
                                    [class.copied]="isCopied"
                                    (click)="copyUserIdToClipboard()" 
                                    title="Copy to clipboard">
                                {{ isCopied ? 'Copied' : 'Copy' }}
                            </button>
                        </div>
                    </div>
                </div>
            }
            
            <button type="button" class="login-redirect-button" (click)="goToLoginPage()">
                Go to Login Page
            </button>
        </div>
    </div>
}