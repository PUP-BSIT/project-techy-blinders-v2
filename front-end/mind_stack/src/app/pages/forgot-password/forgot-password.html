<div class="forgot-password-class">
    <div class="forgot-password-label">
        <h1>Forgot Password</h1>
    </div>

    @if (isLoading()) {
        <div class="loading-overlay">
            <div class="spinner"></div>
            <p>Sending...</p>
        </div>
    }

    <form [formGroup]="forgotPasswordForm">
        @if (currentStep() === 1) {
            <div class="form-group">
                <div class="email-class">
                    <div class="email-label">
                        <label>Email:</label>
                    </div>
                    <input type="text" formControlName="email" placeholder="Enter email...">
                    @if (emailControl?.touched) {
                        @if (emailControl?.errors?.['required']) {
                            <div>
                                <span>Email is required</span>
                            </div>
                        }
                        @if (emailControl?.errors?.['email']) {
                            <div>
                                <span>Invalid email</span>
                            </div>
                        }
                    }
                </div>

                <div class="new-pass-class">
                    <div class="new-pass-label">
                        <label>New Password:</label>
                    </div>
                    <input type="password" formControlName="newPassword" placeholder="Enter new password...">
                    @if (newPasswordControl?.touched) {
                        @if (newPasswordControl?.errors?.['required']) {
                            <div>
                                <span>New password is required</span>
                            </div>
                        }
                        @if (newPasswordControl?.errors?.['minlength']) {
                            <div>
                                <span>Password must be at least 6 characters</span>
                            </div>
                        }
                    }
                </div>

                <div class="confirm-pass-class">
                    <div class="confirm-pass-label">
                        <label>Confirm Password:</label>
                    </div>
                    <input type="password" formControlName="confirmPassword" placeholder="Confirm new password...">
                    @if (confirmPasswordControl?.touched) {
                        @if (confirmPasswordControl?.errors?.['required']) {
                            <div>
                                <span>Confirm password is required</span>
                            </div>
                        }
                        @if (errorMessage()) {
                            <div class="error-message">{{ errorMessage() }}</div>
                        }
                    }
                </div>
            </div>

            <div class="button-class">
                <button type="button" (click)="next()" [disabled]="isLoading() || !forgotPasswordForm.get('email')?.value || !forgotPasswordForm.get('newPassword')?.value || !forgotPasswordForm.get('confirmPassword')?.value || forgotPasswordForm.get('email')?.invalid || forgotPasswordForm.get('newPassword')?.invalid || forgotPasswordForm.get('confirmPassword')?.invalid" id="next_button">Next</button>
                <button type="button" (click)="cancel()" [disabled]="isLoading()" id="cancel_button">Cancel</button>
            </div>
        } @else if (currentStep() === 2) {
            <div class="form-group">
                <div class="otp-class">
                    <button type="button" (click)="sendOtp()" [disabled]="isLoading()" class="btn-secondary">{{ otpSent() ? 'Resend OTP' : 'Send OTP' }}</button>

                    <input
                      type="text"
                      formControlName="otp"
                      placeholder="Enter OTP..."
                      inputmode="numeric"
                      maxlength="6"
                      pattern="\d{6}"
                      class="otp-input"
                      aria-label="OTP"
                      [attr.autofocus]="currentStep() === 2 ? true : null"
                    >
                    <small class="helper-text">Enter the 6-digit code we sent to your email.</small>

                    @if (otpControl?.touched) {
                        @if (otpControl?.errors?.['required']) {
                            <div>
                                <span class="otp_error_message">OTP is required</span>
                            </div>
                        }
                        @if (otpControl?.errors?.['pattern']) {
                            <div>
                                <span class="otp_error_message">OTP must be 6 digits</span>
                            </div>
                        }
                    }
                </div>
            </div>

            <div class="button-class">
                <!-- <button type="button" (click)="currentStep.set(1); otpSent.set(false)" [disabled]="isLoading()" class="btn-secondary">Back</button> -->
                <button type="button" (click)="resetPassword()" [disabled]="forgotPasswordForm.invalid || isLoading()" class="btn-primary">Reset Password</button>
            </div>
        }
    </form>

    <!-- @if (errorMessage()) {
        <div class="error-message">{{ errorMessage() }}</div>
    } -->

    <!-- @if (successMessage()) {
        <div class="success-message">{{ successMessage() }}</div>
    } -->

    <!-- @if (showSuccessPopup()) {
        <div class="success-popup">
            <p>Password reset link sent!</p>
            <button (click)="closeSuccessPopup()">Close</button>
        </div>
    } -->
</div>