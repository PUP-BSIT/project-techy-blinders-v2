<div class="container" [class.hidden]="!quiz()">
    <button class="back-btn" (click)="goBack()">
        ‹ Back
    </button>

    <div class="play-wrapper">
        <!-- clickable card   -->
        <div class="play-card" (click)="isAnswerRevealed() ? $event.stopPropagation() : null">
            <div class="grad-cap-icon">
                <img src="/assets/image-logo.png" alt="Logo">
            </div>

            <div class="play-card-content">

                <div class="indicator">
                    @if (!isAnswerRevealed()) {
                        <span>QUESTION</span>
                    } @else {
                        <span>ANSWER</span>
                    }
                </div>

                @if (!isAnswerRevealed()) {
                    <div class="question-section">
                        <h2 class="question-text">{{ currentQuestion()?.question }}</h2>

                        <!-- m.choice options -->
                        @if (isMultipleChoice()) {
                            <div class="choices">
                                <div 
                                    class="choice" 
                                    [class.selected]="selectedAnswer() === 'A'"
                                    (click)="selectAnswer('A')">
                                    <b>A.</b> {{ currentQuestion()?.optionA }}
                                </div>

                                <div 
                                    class="choice" 
                                    [class.selected]="selectedAnswer() === 'B'"
                                    (click)="selectAnswer('B')">
                                    <b>B.</b> {{ currentQuestion()?.optionB }}
                                </div>

                                <div 
                                    class="choice" 
                                    [class.selected]="selectedAnswer() === 'C'"
                                    (click)="selectAnswer('C')">
                                    <b>C.</b> {{ currentQuestion()?.optionC }}
                                </div>

                                <div 
                                    class="choice" 
                                    [class.selected]="selectedAnswer() === 'D'"
                                    (click)="selectAnswer('D')">
                                    <b>D.</b> {{ currentQuestion()?.optionD }}
                                </div>
                            </div>
                        }

                        <!-- identification input -->
                        @if (isIdentification()) {
                            <div class="identification-input">
                                <input 
                                    type="text" 
                                    [(ngModel)]="userTypedAnswer"
                                    placeholder="Type your answer here..."
                                    class="answer-input"
                                    (click)="$event.stopPropagation()"
                                    (keyup.enter)="revealAnswer()"
                                />
                            </div>
                        }

                        <button 
                            class="reveal-btn" 
                            (click)="revealAnswer()"
                            [disabled]="(isMultipleChoice() && !selectedAnswer()) || (isIdentification() && !userTypedAnswer().trim())">
                            Check Answer
                        </button>
                    </div>
                }

                <!-- answer -->
                @if (isAnswerRevealed()) {
                    <div class="answer-section">
                        <!-- m. choice -->
                        @if (isMultipleChoice() && selectedAnswer()) {
                            <p class="user-answer">
                                <strong>Your answer: </strong> 
                                <span [class.wrong]="!isCorrect()">{{ selectedAnswer() }}</span>
                            </p>
                        }

                        <div class="result-badge" [class.correct]="isCorrect()" [class.incorrect]="!isCorrect()">
                            @if (isCorrect()) {
                                <span id="correct">Correct!</span>
                            } @else {
                                <span id="incorrect">Incorrect!</span>
                            }
                        </div>

                        <!-- ident -->
                        @if (isIdentification() && userTypedAnswer()) {
                            <p class="user-answer">
                                <strong>Your answer: </strong> 
                                <span [class.wrong]="!isCorrect()">{{ userTypedAnswer() }}</span>
                            </p>
                        }

                        <!-- Show correct answer -->
                        <h2 class="answer-text">
                            Correct Answer:
                            <span class="correct">
                                @if (isMultipleChoice()) {
                                    {{ currentQuestion()?.correctAnswer }}
                                } @else {
                                    {{ currentQuestion()?.answer }}
                                }
                            </span>
                        </h2>

                        <!-- answer for multiple choice -->
                        @if (isMultipleChoice()) {
                        <p class="full-answer">
                            @switch(currentQuestion()?.correctAnswer) {
                            @case('A') {
                                A. {{ currentQuestion()?.optionA }}
                            }
                            @case('B') {
                                B. {{ currentQuestion()?.optionB }}
                            }
                            @case('C') {
                                C. {{ currentQuestion()?.optionC }}
                            }
                            @case('D') {
                                D. {{ currentQuestion()?.optionD }}
                            }
                            }
                        </p>
                        }

                        <!-- optional for now -->
                        @if (currentQuestion()?.explanation) {
                            <p class="explanation">
                                <strong>Explanation:</strong><br>
                                {{ currentQuestion()?.explanation }}
                            </p>
                        }
                    </div>
                }
            </div>

            <span class="page-indicator">
                Question {{ currentIndex() + 1 }} of {{ totalQuestions() }}
            </span>
        </div>

        <div class="play-navigation">
            <button
                class="nav-btn prev"
                (click)="previousQuestion()"
                [disabled]="currentIndex() === 0">
                ‹
            </button>

            <button
                class="nav-btn next"
                (click)="nextQuestion()"
                [disabled]="currentIndex() === totalQuestions() - 1">
                ›
            </button>
        </div>
    </div>
</div>

<!-- optional for now if thee quiz is not found -->
<div class="container error-container" [class.hidden]="quiz()">
    <div class="error-message">
        <h2>Quiz Not Found</h2>
        <p>The quiz you're looking for doesn't exist.</p>
        <button class="btn btn-primary" (click)="goBack()">Go Back to Quizzes</button>
    </div>
</div>