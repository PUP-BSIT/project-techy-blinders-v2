<div class="container" [class.hidden]="!quiz()">
    <button class="back-btn" (click)="goBack()">
        ‹ Back
    </button>

    <div class="play-wrapper">
        <div class="play-card" (click)="isAnswerRevealed() ? $event.stopPropagation() : null">
            <div class="grad-cap-icon">
                <img src="/assets/image-logo.png" alt="Logo">
            </div>

            <div class="play-card-content">

                <div class="indicator">
                    @if (!isAnswerRevealed()) {
                        <span>QUESTION</span>
                    } @else {
                        <span>ANSWER</span>
                    }
                </div>

                @if (!isAnswerRevealed()) {
                    <div class="question-section">
                        <h2 class="question-text">{{ currentQuestion()?.question }}</h2>

                        @if (isMultipleChoice()) {
                            <div class="choices">
                                <div 
                                    class="choice" 
                                    [class.selected]="selectedAnswer() === 'A'"
                                    (click)="selectAnswer('A')">
                                    <b>A.</b> {{ currentQuestion()?.optionA }}
                                </div>

                                <div 
                                    class="choice" 
                                    [class.selected]="selectedAnswer() === 'B'"
                                    (click)="selectAnswer('B')">
                                    <b>B.</b> {{ currentQuestion()?.optionB }}
                                </div>

                                <div 
                                    class="choice" 
                                    [class.selected]="selectedAnswer() === 'C'"
                                    (click)="selectAnswer('C')">
                                    <b>C.</b> {{ currentQuestion()?.optionC }}
                                </div>

                                <div 
                                    class="choice" 
                                    [class.selected]="selectedAnswer() === 'D'"
                                    (click)="selectAnswer('D')">
                                    <b>D.</b> {{ currentQuestion()?.optionD }}
                                </div>
                            </div>
                        }

                        @if (isIdentification()) {
                            <div class="identification-input">
                                <input 
                                    type="text" 
                                    [(ngModel)]="userTypedAnswer"
                                    placeholder="Type your answer here..."
                                    class="answer-input"
                                    (click)="$event.stopPropagation()"
                                    (keyup.enter)="revealAnswer()"
                                />
                            </div>
                        }

                        <button 
                            class="reveal-btn" 
                            (click)="revealAnswer()"
                            [disabled]="(isMultipleChoice() && !selectedAnswer()) || (isIdentification() && !userTypedAnswer().trim())">
                            Submit Answer
                        </button>
                    </div>
                }

                @if (isAnswerRevealed()) {
                    <div class="answer-section">
                        @if (isMultipleChoice() && selectedAnswer()) {
                            <p class="user-answer">
                                <strong>Your answer: </strong> 
                                <span [class.wrong]="!isCorrect()">{{ selectedAnswer() }}</span>
                            </p>
                        }

                        @if (isIdentification() && userTypedAnswer()) {
                            <p class="user-answer">
                                <strong>Your answer: </strong> 
                                <span [class.wrong]="!isCorrect()">{{ userTypedAnswer() }}</span>
                            </p>
                        }

                        <div 
                            class="result-badge show" 
                            [class.correct]="isCorrect()" 
                            [class.incorrect]="!isCorrect()">
                            @if (isCorrect()) {
                                <span id="correct">Correct!</span>
                            } @else {
                                <span id="incorrect">Incorrect!</span>
                            }
                        </div>

                        <h2 class="answer-text">Correct Answer:</h2>

                        @if (isMultipleChoice()) {
                            <p class="full-answer">
                                @switch(currentQuestion()?.correctAnswer) {
                                    @case('A') { A. {{ currentQuestion()?.optionA }} }
                                    @case('B') { B. {{ currentQuestion()?.optionB }} }
                                    @case('C') { C. {{ currentQuestion()?.optionC }} }
                                    @case('D') { D. {{ currentQuestion()?.optionD }} }
                                }
                            </p>
                        }

                        @if (isIdentification()) {
                            <p class="full-answer">{{ currentQuestion()?.answer }}</p>
                        }

                        @if (currentIndex() < totalQuestions() - 1) {
                            <button
                                class="next_item_btn"
                                (click)="nextQuestion()">
                                Next >
                            </button>
                        } @else {
                            <div class="score-section">
                                <button class="score-btn" (click)="openScoreModal()">
                                    Show Score
                                </button>
                            </div>
                        }
                    </div>
                }
            </div>

            <div class="score-section">
                @if (scoreVisible()) {
                    <div class="score-display">
                        <h2>Your Score: {{ totalCorrect() }} / {{ totalQuestions() }}</h2>
                    </div>
                }
            </div>

            <span class="page-indicator">
                Question {{ currentIndex() + 1 }} of {{ totalQuestions() }}
            </span>
        </div>

        <!-- removed temporarily -->
        <!-- <div class="play-navigation">
            <button
                class="nav-btn prev"
                (click)="previousQuestion()"
                [disabled]="currentIndex() === 0">
                ‹
            </button>

            <button
                class="nav-btn next"
                (click)="nextQuestion()"
                [disabled]="currentIndex() === totalQuestions() - 1">
                ›
            </button>
        </div> -->
    </div>
</div>

@if (!isLoading() && !quiz()) {
<div class="container error-container">
    <div class="error-message">
        <h2>Quiz Not Found</h2>
        <p>The quiz you're looking for doesn't exist.</p>
        <button class="btn btn-primary" (click)="goBack()">Go Back to Quizzes</button>
    </div>
</div>
}

@if (scoreModalOpen()) {
<div class="score-modal-backdrop"></div>

<div class="score-modal">
    <div class="modal-content">
        <h2 id="score_text">Score:</h2>

        <div class="score-circle">
            <div class="score-value">
                {{ totalCorrect() }}
                <span class="small">/ {{ totalQuestions() }}</span>
            </div>
        </div>

        <h3 class="feedback-text">
            {{
                totalCorrect() / totalQuestions() >= 0.8 ? 'Excellent!' :
                totalCorrect() / totalQuestions() >= 0.5 ? 'Good Job!' :
                'Keep Practicing!'
            }}
        </h3>

        <div class="modal-actions">
            <button class="primary-btn" (click)="retakeQuiz()">Retake Quiz</button>
            <button class="secondary-btn" (click)="goBack()">Back to Quizzes</button>
        </div>

        <button class="close-btnn" (click)="closeScoreModal()">Close</button>

    </div>
</div>
}