<app-nav-bar></app-nav-bar>

<div class="container">
    <div class="login-card">
        <div class="logo-class">
            <div class="header-class">
                <h1>Your Study Journey Starts Here!</h1>
            </div>

            <div class="image-class">
                <img src="assets/toga.png" alt="Logo">
            </div>
        </div>

        <div class="seperator-class"></div>

        <div class="login-form">
        <form [formGroup]="loginForm" (ngSubmit)="login()">
            <div class="email-class">
                <div><label>Email</label></div>
                <input formControlName="email" type="text" placeholder="Enter your email">

                @if (emailControl?.touched) {
                    @if(emailControl?.errors?.['required']) {
                        <p class="validators-message">Email is required</p>
                    } @else if (emailControl?.errors?.['email']) {
                        <p class="validators-message">Invalid email format</p>
                    } @else if (emailControl?.errors?.['maxLength']) {
                        <p class="validators-message">Email Exceed</p>
                    }
                }
            </div>

            <!-- Password -->
            <div class="password-class">
                <div><label>Password</label></div>
                <div class="password-input-container">
                    <input formControlName="password" [type]="showPassword ? 'text' : 'password'" placeholder="Enter your password">
                    <button type="button" class="show-password-btn" (click)="togglePasswordVisibility()">
                        <img [src]="showPassword ? 'assets/unshow-password-icon.png' : 'assets/show-password-icon.png'"
                              [alt]="showPassword ? 'Hide password' : 'Show password'">
                    </button>
                </div>

                @if (passwordControl?.touched) {
                    @if(passwordControl?.errors?.['required']) {
                        <p class="validators-message">Password is required</p>
                    }
                }
            </div>

            <!-- Forgot password -->
                <div class="forgot-password">
                    <a routerLink="/forgot-password">
                        Forgot Password?
                    </a>
                </div>

            <!-- Login button -->
            <div class="login-button">
                <button type="submit" [disabled]="!loginForm.valid || isLoading">Login</button>
            </div>

            <p class="register-class">Don't have an account? <a routerLink="/register"> Register</a></p>
        </form>
        </div>
    </div>

    @if (successModalOpen()) {
        <div class="modal-backdrop"></div>

        <div class="success-modal">
            <div class="modal-content">
                <!-- Spinner -->
                <div class="spinner"></div>
                <h2>Logging In...</h2>
                <p>Please wait</p>
            </div>
        </div>
    }

    @if (errorModalOpen() && errorMessage) {
        <div class="popup-overlay" (click)="closeErrorModal()">
            <div class="popup warning" (click)="$event.stopPropagation()">
                <h2>Error</h2>
                <p>{{ errorMessage }}</p>
                <button (click)="closeErrorModal()">Close</button>
            </div>
        </div>
    }
</div>