<div class="post-card-wrapper">
  <div class="user-header">
    <div class="user-avatar" 
         (click)="goToUserProfile($event, post.user_id)">{{ getInitial(post.username) }}</div>
    <div class="user-info">
      <div class="username" (click)="goToUserProfile($event, post.user_id)">{{ post.username }}</div>
      <div class="timestamp">Posted {{ getTimeAgo(post.created_at) }}</div>
    </div>
  </div>

  <div class="post-card" (click)="onCardClick()">
    <div class="post-header">
      <span class="post-label">Caption:</span>
      <span class="post-category">{{ post.title }}</span>
      @if (isPostOwner()) {
      <button class="menu-btn" (click)="toggleMenu($event)">
        <svg width="4" height="16" viewBox="0 0 4 16" fill="currentColor">
          <circle cx="2" cy="2" r="2"/>
          <circle cx="2" cy="8" r="2"/>
          <circle cx="2" cy="14" r="2"/>
        </svg>
      </button>
      @if (showMenu) {
        <div class="dropdown-menu">
          <button class="dropdown-item" (click)="onEdit($event)">
            <svg width="14" height="14" 
                 viewBox="0 0 14 14" 
                 fill="none" 
                 stroke="currentColor">
              <path d="M10 1.5L12.5 4L4.5 12H2V9.5L10 1.5Z" 
                    stroke-width="1.5" 
                    stroke-linecap="round" 
                    stroke-linejoin="round"/>
            </svg>
            Edit
          </button>
          <button class="dropdown-item delete" (click)="onDelete($event)">
            <svg width="14" 
                 height="14" 
                 viewBox="0 0 14 14" 
                 fill="none" 
                 stroke="currentColor">
              <path d="M1.5 3.5H12.5M11 3.5V12C11 12.5 10.5 13 10 13H4C3.5 13 3 12.5 3 12V3.5M4.5 3.5V2C4.5 1.5 5 1 5.5 1H8.5C9 1 9.5 1.5 9.5 2V3.5" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Delete Post
          </button>
      
        </div>
      }
      }
    </div>


    @if (showDeleteConfirm) {
      <div class="confirm-overlay" (click)="cancelDelete($event)">
        <div class="confirm-modal" (click)="$event.stopPropagation()">
          <div class="confirm-title">Delete this post?</div>
          <div class="confirm-subtext">
            This will permanently delete the post from Community and set the linked flashcard/quiz to Private. This action cannot be undone.
          </div>
          <div class="confirm-actions">
            <button class="btn-cancel" (click)="cancelDelete($event)">Cancel</button>
            <button class="btn-danger" (click)="confirmDelete($event)">Delete</button>
          </div>
        </div>
      </div>
    }
    <div class="post-category-section">
      <span class="category-label">Category:</span>
      <span class="category-value">{{ post.category }}</span>
    </div>

    <div class="post-content-card">
      <button class="play-btn" (click)="onPlayClick($event)">
        â–¶
      </button>
      <div class="post-info">
        <h3 class="post-title">{{ getOriginalTitle() }}</h3>
        <p class="post-subtitle">{{ getSubtitle() }}</p>
      </div>
    </div>

    <div class="action-buttons">
      <button class="action-btn" [class.active]="post.userLiked" (click)="onLike($event)">
        <img src="assets/arrow-up.png" alt="like" class="action-icon">
        <span>{{ post.likes }}</span>
      </button>
      <button class="action-btn" [class.active]="post.userDisliked" (click)="onDislike($event)">
        <img src="assets/arrow-down.png" alt="dislike" class="action-icon">
        <span>{{ post.dislikes }}</span>
      </button>
      <button class="action-btn" (click)="onCommentClick($event)">
        <img src="assets/comment-circle.png" alt="comment" class="action-icon">
        <span>{{ post.commentcount }}</span>
      </button>
    </div>
  </div>
</div>